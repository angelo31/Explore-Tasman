<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css"/>
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.js"></script>
</head>

<body>

  <div data-role="page" id = "first">
    <div role="main" class="ui-content">

      <p id="demo">Click the button to get your position:</p>
      <button id="button1">Try It</button>

      <div id="mapholder"></div>
      <div id="result" class="functions"></div>
      <p id = "text"></p>
      <button id="saveButton">Save coordinates</button>
      <button id="loadButton">Load random coordinates</button>

      <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
      <script type="text/javascript" src = "cordova-1.7.0.js"></script>

      <script type="text/javascript">
      $("#button1").bind("click", function(event, ui) {
        var x=document.getElementById("demo");
        var gah =document.getElementById("text");

        getLocation();

        function getLocation() {
          if (navigator.geolocation)
          {
            navigator.geolocation.getCurrentPosition(showPosition,showError);
          }
          else{x.innerHTML="Geolocation is not supported by this browser.";}
        }

        function showPosition(position) {
          lat=position.coords.latitude;
          lon=position.coords.longitude;
          latlon=new google.maps.LatLng(lat, lon)
          mapholder=document.getElementById('result')
          mapholder.style.height='250px';
          mapholder.style.width='250px';

          var myOptions={
            center:latlon,zoom:14,
            mapTypeId:google.maps.MapTypeId.ROADMAP,
            mapTypeControl:false,
            navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
          };
          var map=new google.maps.Map(document.getElementById("result"),myOptions);
          var marker=new google.maps.Marker({position:latlon,map:map,title:"You are here!"});

          //gah.innerHTML = "Latitude: " + lat + "<br>Longitude: " + lon;
          $("#text").html("<p>Latitude: " + lat + "<br>Longitude: " + lon + "</p>")
          $("#saveButton").bind("click", function(event, ui) { 
             alert("saving " + lat + " and " + lon)
             var url = "http://intense-harbor-6396.herokuapp.com/location"
             var newCoords = { "lat" : lat, "lon" : lon };

             $.post(url,newCoords, function(data) {
              alert("Added coordinates " + data.lat + " " + data.lon);
            }, 'json');
           });
        }

        function showNewPosition(position, lat, lon) {
          lat=lat;
          lon=lon;
          latlon=new google.maps.LatLng(lat, lon)
          mapholder=document.getElementById('result')
          mapholder.style.height='250px';
          mapholder.style.width='250px';

          var myOptions={
            center:latlon,zoom:14,
            mapTypeId:google.maps.MapTypeId.ROADMAP,
            mapTypeControl:false,
            navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
          };
          var map=new google.maps.Map(document.getElementById("result"),myOptions);
          var marker=new google.maps.Marker({position:latlon,map:map,title:"You are here!"});
          
        }

        function showError(error) {
          switch(error.code) {
            case error.PERMISSION_DENIED:
            x.innerHTML="User denied the request for Geolocation."
            break;
            case error.POSITION_UNAVAILABLE:
            x.innerHTML="Location information is unavailable."
            break;
            case error.TIMEOUT:
            x.innerHTML="The request to get user location timed out."
            break;
            case error.UNKNOWN_ERROR:
            x.innerHTML="An unknown error occurred."
            break;
          }
        }
      });

// load some coordinates
$("#loadButton").bind("click", function(event, ui) { 
    alert("loading some new coordinates")
    var url = "http://intense-harbor-6396.herokuapp.com/location/random";

    $.get(url, function(data) {
      alert("got coordinates " + data.lat + " " + data.lon);
    showNewPosition(position, data.lat, data.lon)
    }, 'json');
  });


</script>
</div>

</body>
</html>
